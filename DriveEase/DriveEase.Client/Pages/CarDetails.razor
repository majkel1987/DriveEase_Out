@page "/car/{id:int}"
@inject IConfiguration Configuration
@inject ICarHttpRepository CarHttpRepository
@inject NavigationManager NavigationManager
@rendermode InteractiveAuto

<PageTitle>Szczegóły Pojazdu</PageTitle>

@if (_car == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <section class="container my-3">
        <header class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <h6 class="text-muted">Flota</h6>
                <h3>@_car.Brand - @_car.Model</h3>
            </div>
            <div class="mb-3">
                <button class="btn btn-outline-primary" onclick="NavigateToReservations()">Zobacz rezerwacje</button>
            </div>
        </header>
        <nav class="navbar navbar-expand-lg bg-body-tertiary mb-3" style="background-color: #e3f2fd;">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Podsumowanie</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Kalendarz Pojazdu</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Cennik</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Uszkodzenia</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Dokumenty</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <main class="row">
            <section class="col-md-6 mb-4">
                <div class="card shadow-sm" style="background-color: white;">
                    <h5 class="card-header">
                        Szczegóły Pojazdu
                    </h5>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Pojazd:</span>
                                <span>@_car.Brand - @_car.Model - @_car.Engine</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Tablica rejestracyjna:</span>
                                <span>@_car.LicensePlate</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Numer VIN:</span>
                                <span>@_car.VinNumber</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Moc:</span>
                                <span>Brak danych</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Rok produkcji:</span>
                                <span>@_car.Year</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Kolor:</span>
                                <span>@_car.Color</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Rodzaj paliwa:</span>
                                <span>@_car.FuelType</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Polisa ubezpieczeniowa:</span>
                                <span>@_car.InsurancePolicyNumber</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Wyposażenie:</span>
                                @foreach (var feature in _car.Features)
                                {
                                    <span>@feature</span>
                                }
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Przegląd gwarancyjny:</span>
                                <span>Brak danych</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Data dodania:</span>
                                <span>12 maj 2024, 08:52</span>
                            </li>
                            <li class="d-flex mb-2">
                                <span class="font-weight-bold text-left" style="min-width: 250px;">Stan przebiegu:</span>
                                <span>@_car.Mileage</span>
                            </li>
                        </ul>
                        <div class="mb-3">
                            <RadzenButton ButtonType="ButtonType.Submit" Text="Edytuj pojazd" IconPosition="IconPosition.Left"
                                          Variant="Variant.Filled" ButtonStyle="ButtonStyle.Primary" Click="@NavigateToEditCar" />
                        </div>
                    </div>
                </div>
            </section>
            <section class="col-md-6 mb-4">
                <div class="card shadow-sm" style="background-color: white;">
                    <h5 class="card-header">
                        Serwisowanie Pojazdu
                    </h5>
                    <div class="card-body">
                        <ul class="list-unstyled d-flex justify-content-between">
                            <li class="col text-center">
                                <div class="text-danger font-weight-bold" style="font-size: 2em;">1</div>
                                <span class="font-weight-bold" style="font-size: 1em;">Zaplanowane serwisy</span>
                            </li>
                            <li class="col text-center">
                                <div class="text-danger font-weight-bold" style="font-size: 2em;">1</div>
                                <span class="font-weight-bold" style="font-size: 1em;">Trwające serwisy</span>
                            </li>
                            <li class="col text-center">
                                <div class="text-danger font-weight-bold" style="font-size: 2em;">1</div>
                                <span class="font-weight-bold" style="font-size: 1em;">Zakończone serwisy</span>
                            </li>
                        </ul>
                        <a href="#" class="btn btn-primary">Dodaj serwis</a>
                    </div>
                </div>
            </section>
        </main>
    </section>
}

@code {
	[Parameter]
	public int Id { get; set; }

	private CarDto _car;
	private string _baseUrl = string.Empty;

	protected override async Task OnInitializedAsync()
	{
		_baseUrl = Configuration["ApiConfiguration:BaseAddress"];

		try
		{
			_car = await CarHttpRepository.GetCarById(Id);
		}
		catch (Exception ex)
		{
			Console.WriteLine($"Błąd podczas ładowania danych: {ex.Message}");
		}
	}

	private void NavigateToReservations()
	{
        NavigationManager.NavigateTo($"/");
	}

private void NavigateToEditCar()
	{
		NavigationManager.NavigateTo($"/editcar/{_car.Id}");
	}
}
